1. Начало программы:
   - Программа начинается с подключения необходимых заголовочных файлов, которые предоставляют доступ к функциям Windows API, работе с USB-устройствами, и стандартным библиотекам C++.

2. Объявление глобальных переменных и структур:
   - Объявляется глобальная переменная `lastSafelyRemovedDeviceId` для хранения идентификатора последнего безопасно извлеченного устройства.
   - Определяется структура `Device`, которая содержит информацию об USB-устройстве: имя, аппаратный идентификатор, флаг возможности извлечения и дескриптор устройства.
   - Объявляется глобальный вектор `devices` для хранения списка обнаруженных устройств.

3. Функция `updateDeviceList()`:
   - Эта функция отвечает за обновление списка USB-устройств.
   - Сначала очищается текущий список устройств.
   - Затем используется функция `SetupDiGetClassDevsW` для получения информации о классе USB-устройств.
   - В цикле перебираются все найденные устройства, и для каждого устройства:
     - Получается имя устройства и его аппаратный идентификатор.
     - Определяется, является ли устройство извлекаемым.
     - Создается объект `Device` и добавляется в вектор `devices`.
   - После обработки всех устройств освобождаются ресурсы, связанные с информацией об устройствах.

4. Функция `printDevices()`:
   - Эта функция отвечает за вывод списка устройств на экран.
   - Сначала очищается консоль.
   - Затем выводится заголовок "Список USB-устройств".
   - В цикле перебираются все устройства из вектора `devices`, и для каждого устройства выводится его номер и информация (аппаратный ID и имя).
   - В конце выводится инструкция для пользователя.

5. Функция `checkForUnsafeRemoval()`:
   - Эта функция проверяет, не было ли устройство извлечено небезопасно.
   - Используются статические векторы `previousDevices` и `reportedDevices` для отслеживания изменений в списке устройств.
   - Сравнивается текущий список устройств с предыдущим.
   - Если устройство исчезло из списка, не было безопасно извлечено и о нем еще не сообщалось, выводится предупреждение.
   - Обновляется список предыдущих устройств и очищается список сообщенных устройств, которые снова появились.

6. Функция `main()`:
   - Устанавливается локаль для корректного отображения русских символов.
   - Запускается основной цикл программы:
     - Каждую секунду обновляется список устройств, выводится на экран и проверяется на небезопасное извлечение.
     - Проверяется ввод пользователя:
       - Если нажата 'q' или 'Q', программа завершается.
       - Если нажата цифра от 1 до 9, происходит попытка извлечения соответствующего устройства.
     - Если устройство успешно извлечено, его ID сохраняется как последнее безопасно извлеченное.
     - После каждой операции извлечения список устройств обновляется и выводится заново.
   - Цикл повторяется каждые 100 миллисекунд для снижения нагрузки на процессор.

7. Завершение программы:
   - После выхода из основного цикла программа завершается, возвращая 0.

Этот алгоритм обеспечивает непрерывный мониторинг USB-устройств, позволяет пользователю безопасно извлекать устройства и предупреждает о небезопасном извлечении. Программа использует Windows API для работы с устройствами и обеспечивает удобный пользовательский интерфейс в консоли.